---
description: |
  Provides a high-level overview of the ZyntraJS core architecture, its integration with the Next.js App Router, the feature-based API structure, and the universal type-safe client.
alwaysApply: true
---

# ZyntraJS: Core Architecture

This document outlines the foundational architecture of an ZyntraJS application when integrated with the Next.js App Router.

## 1. Core Architectural Principles

The application leverages the Next.js App Router to execute code on both the server (React Server Components, API Routes) and the client (Client Components). ZyntraJS is integrated as a structured, type-safe API layer that sits within the Next.js project.

### 1.1. API Entry Point: The Bridge
All API requests are funneled through the main Express application, which acts as a bridge to the ZyntraJS backend.

-   **File Location**: `src/index.ts`
-   **Mechanism**: This file uses the `expressAdapter` to integrate the ZyntraJS router with Express. It translates incoming Express requests into a format ZyntraJS can process and translates ZyntraJS responses back into a format Express can serve. It handles all HTTP methods (`GET`, `POST`, etc.) for any route matching the `ZYNTRA_API_BASE_PATH` (e.g., `/api/v1/*`). You will rarely need to modify this file.

### 1.2. API Layer: Feature-Based Structure
All backend business logic is organized using a **Feature-Based Architecture** within the `src/features` directory.

-   `src/zyntra.ts`: The central configuration file where the `zyntra` instance is created. This is where global plugins and adapters are registered.
-   `src/zyntra.router.ts`: This file assembles the main `AppRouter` by importing and registering all feature controllers. It serves as the **single source of truth** for your API's structure and endpoints.
-   `src/features/[feature]/controllers/`: This is where your business logic resides. Each controller defines a set of related API `actions` (`query`, `mutation`).

### 1.3. The Universal Type-Safe Client
The file `src/zyntra.client.ts` defines the **isomorphic, type-safe ZyntraJS API client**. This is the primary interface for frontend-backend communication.

-   **Auto-Generated:** This file **MUST NOT be edited manually**. It is a build artifact that is automatically regenerated by the development server whenever `zyntra.router.ts` changes.
-   **Universal Operation:** The client is designed to work seamlessly in all Next.js rendering environments:
    -   **React Server Components (RSC):** You can call API actions directly as if they were local functions (e.g., `await api.posts.list.query()`). This executes a direct function call on the server, bypassing HTTP for maximum performance.
    -   **Client Components (`'use client'`):** You **must** use the provided React Query hooks (e.g., `api.posts.list.useQuery()`). These hooks handle standard HTTP requests and manage the entire client-side state lifecycle, including loading, errors, and caching.

## 2. The Zyntra Builder (`zyntra.ts`)

The application instance is configured using a fluent, type-safe builder pattern.

```typescript
// src/zyntra.ts
export const zyntra = Zyntra
  // 1. Define the base context shape for dependency injection
  .context<ZyntraAppContext>()
  // 2. Attach a structured logger
  .logger(logger)
  // 3. Enable the Redis-based Store (for caching and pub/sub)
  .store(store)
  // 4. Enable the BullMQ-based background jobs system
  .jobs(REGISTERED_JOBS)
  // 5. Enable OpenAPI documentation and Zyntra Studio
  .docs({
    openapi,
  })
  // 6. Set the base URL and path for the API
  .config({
    baseURL: process.env.NEXT_PUBLIC_ZYNTRA_API_URL || 'http://localhost:3000',
    basePath: process.env.NEXT_PUBLIC_ZYNTRA_API_BASE_PATH || '/api/v1',
  })
  // 7. Finalize the configuration and create the instance
  .create();
```
